<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login - Portal de Feedback IFCE</title>

  <!-- Bootstrap e estilos do projeto -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/login.css" />

  <!-- Patch: redireciona fetch('/rota') para o backend Flask (porta 5000) -->
  <script>
    (function () {
      const API_BASE = 'http://127.0.0.1:5000';
      const origFetch = window.fetch.bind(window);
      window.fetch = (input, init) => {
        const toUrl = v => (typeof v === 'string' ? v : v.url);
        let url = toUrl(input);
        if (/^\/(?!\/)/.test(url)) url = API_BASE + url;
        return origFetch(url, init);
      };
    })();
  </script>

  <!-- Carrega a logo via /images em BASE64 e injeta no <img id="logo-ifce"> -->
  <script>
    (function () {
      const LOGO_IMAGE_NAME = 'logo-if.png';

      function guessMime(ext) {
        ext = String(ext || '').toLowerCase();
        if (ext === 'png') return 'image/png';
        if (ext === 'jpg' || ext === 'jpeg') return 'image/jpeg';
        if (ext === 'webp') return 'image/webp';
        if (ext === 'gif') return 'image/gif';
        if (ext === 'svg') return 'image/svg+xml';
        return 'application/octet-stream';}

      document.addEventListener('DOMContentLoaded', () => {
        const logoEl = document.getElementById('logo-ifce');
        if (!logoEl) return;
        const ext = LOGO_IMAGE_NAME.split('.').pop();
        const mime = guessMime(ext);

        fetch(`/images?nome=${encodeURIComponent(LOGO_IMAGE_NAME)}`)
          .then(r => r.json())
          .then(({ ok, data, error }) => {
            if (ok && data && data.base64) {
              logoEl.src = `data:${mime};base64,${data.base64}`;
            } else {
              console.warn('Falha ao obter logo via API:', error);
              // Fallback opcional se existir um arquivo local:
              logoEl.src = 'img/logo-if.png';}})
          .catch(err => {
            console.error('Erro ao buscar logo:', err);
            // Fallback opcional
            logoEl.src = 'img/logo-if.png';
          });
      });
    })();
  </script>
</head>

<body>
  <a href="entrada.html" class="btn-voltar" aria-label="Voltar">
    <img src="img/seta-voltar.png" alt="Voltar" />
  </a>

  <div class="login-container d-flex justify-content-center align-items-center vh-100">
    <div class="login-box p-4 shadow-lg rounded-4">
      <div class="text-center">
        <!-- src serÃ¡ definido dinamicamente pelo script acima -->
        <img id="logo-ifce" alt="Logo IFCE" class="logo-ifce" />
        <h3 class="text-center mb-5">Portal de Feedback</h3>
      </div>

      <form id="loginForm">
        <div class="mb-2">
          <label for="email">E-mail Institucional</label>
          <input type="email" class="form-control" id="email" placeholder="exemplo@aluno.ifce.edu.br" required />
        </div>

        <div class="mb-5">
          <label for="password">Senha</label>
          <input type="password" class="form-control" id="password" placeholder="Digite sua senha" required />
        </div>

        <button type="submit" class="btn btn-success w-100 mb-3">Entrar</button>
      </form>
    </div>
  </div>

  <script src="js/login.js"></script>
</body>
</html>
